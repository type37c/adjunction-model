# Phase 1 実験 要件定義書 (REQUIREMENTS)

**文書バージョン**: 1.0  
**作成日**: 2026-02-18  
**作成者**: Manus AI

## 1. 概要と目的

本ドキュメントは、`adjunction-model`プロジェクトの**Phase 1: F/G事前訓練**に関する要件を定義するものです。

### 1.1. 背景

プロジェクト全体の目標は、内発的な動機付けによって自律的に学習するエージェントを構築することです。この目標を達成するため、3段階の訓練計画が策定されています。

Phase 1は、その最初のステップであり、エージェントの「目」として機能する**Functor F**と**Functor G**を事前訓練することに焦点を当てます。F/Gは、環境の3D形状を認識し、そのアフォーダンス（行動可能性）を理解する能力を獲得する必要があります。

### 1.2. 目的

Phase 1の主目的は、以下の能力を持つF/Gを訓練することです。

- **形状再構成能力**: 3D形状を入力として受け取り、それを正確に再構成する。
- **アフォーダンス予測能力**: 3D形状から、その物体が持つアフォーダンス（例: 掴める、転がせる）を予測する。

この訓練により、F/Gは後続のPhaseでAgent Cに安定した知覚情報を提供できるようになります。

## 2. スコープ

### 2.1. スコープ内

- Functor FとFunctor Gのモデル実装
- 3D形状とアフォーダンスラベルを持つ合成データセットの生成
- F/Gのみを対象とした訓練ループの実装
- 再構成損失、アフォーダンス予測損失、コヒーレンス正則化を含む損失関数の設計
- 訓練の進捗を監視するためのメトリクスの記録
- 訓練済みモデルのチェックポイント保存機能
- 中断された訓練を再開する機能

### 2.2. スコープ外

- Agent Cの訓練（Phase 1ではパラメータを凍結）
- 内発的報酬の計算と利用
- 注意選択メカニズムの実装
- 複雑な実世界データセットの使用

## 3. 機能要件

| ID | 要件名 | 詳細 |
|----|---|---|
| FR-01 | **モデルアーキテクチャ** | Functor F、Functor G、Agent Cを統合した`AdjunctionModel`を実装する。F/GはPointNetベースのアーキテクチャ、Agent CはGRUベースのリカレントモデルとする。 |
| FR-02 | **データセット** | 立方体、円柱、球体などの単純な3D形状と、それに対応する合成アフォーダンスラベルを生成する`SyntheticAffordanceDataset`を実装する。 |
| FR-03 | **訓練プロセス** | F/Gのパラメータのみを更新する訓練ループを実装する。Agent Cのパラメータは勾配計算から除外する。 |
| FR-04 | **損失関数** | 以下の3つの要素からなる損失関数を実装する：<br>1. **再構成損失 (L_recon)**: 入力形状とG(F(形状))の間の距離（Chamfer距離など）。<br>2. **アフォーダンス損失 (L_aff)**: Fが予測したアフォーダンスと正解ラベルの間の誤差（MSEなど）。<br>3. **コヒーレンス正則化 (L_coherence)**: ηが0に縮退することを防ぐための正則化項。 |
| FR-05 | **チェックポイント機能** | 訓練の途中でモデルの重み、オプティマイザの状態、訓練履歴をファイルに保存する機能を実装する。 |
| FR-06 | **自動再開機能** | 最新のチェックポイントを自動的に検出し、中断されたエポックから訓練を再開する機能を実装する。 |

## 4. 非機能要件

| ID | 要件名 | 詳細 | 評価基準 |
|----|---|---|---|
| NFR-01 | **性能** | 訓練を通じて、再構成誤差（η）が有意に減少すること。 | 検証データセットにおけるηが、訓練終了までに**50%以上**削減されること。 |
| NFR-02 | **安定性** | 訓練プロセスが発散せず、安定して収束すること。 | 損失がNaNやInfにならず、滑らかに減少すること。 |
| NFR-03 | **再現性** | 同じ設定で実験を実行した場合、同様の結果が得られること。 | PyTorchの乱数シードを固定することで担保する。 |
| NFR-04 | **保守性** | コードはモジュール化され、各コンポーネント（モデル、データ、訓練）が明確に分離されていること。 | `src/models`, `src/data`, `src/training`のディレクトリ構造に従う。 |
| NFR-05 | **堅牢性** | サンドボックスのリセットなど、予期せぬ中断が発生しても、最小限の損失で実験を再開できること。 | 定期的なチェックポイント保存と自動再開機能により達成する。 |

## 5. 評価基準（Acceptance Criteria）

Phase 1が成功したと判断するための基準は以下の通りです。

1. **ηの大幅な削減**: 検証データセットにおける再構成誤差（η）が、訓練前のベースラインと比較して**50%以上**削減されていること。
2. **チェックポイントの生成**: 訓練完了後、後続のPhaseで使用可能な最終チェックポイント（`phase1_final.pt`）が生成されていること。
3. **結果レポートの作成**: 実験設定、主要結果、考察をまとめた`RESULTS.md`が生成されていること。
4. **要件の充足**: 本ドキュメントに記載された全ての機能要件・非機能要件が満たされていること。
