# 議論ログ v2（2026年2月13日午後）

## 概要

午後のセッションでは、Agent C v4の本格的訓練実験を実施し、Competence報酬の設計問題を発見・解決した。この過程で、保留構造の創発条件に関する重要な理論的洞察が得られた。

**関連文書**:
- [development_report_2026_02_13_final.md](development_report_2026_02_13_final.md): 実験結果の詳細
- [competence_scaling_analysis_2026_02_13.md](competence_scaling_analysis_2026_02_13.md): Competence報酬の分析
- [suspension_and_confidence.md](suspension_and_confidence.md): 保留構造の理論的背景

---

## 1. 実験の背景：Agent C v4の本格的訓練

### 目的

TODO.mdの優先度A2「本格的訓練実験」を実施し、Agent C v4の振る舞いを観察する。特に、以下の理論的問いに答える：

1. **内発的動機は保留構造を促進するか、阻害するか？**
2. **Agent Cは破綻を避けるか、向き合うか？**
3. **価値関数は正しく機能するか？**

### 実験設定（v1）

- エピソード数: 100
- 形状数: 50
- ハイパーパラメータ: α=0.3（Curiosity）, β=0.5（Competence）, γ=0.2（Novelty）

### 初期結果（v1）

| 指標 | 初期値 | 最終値 | 変化 |
|:---|---:|---:|---:|
| 内発的報酬 | 0.025 | 0.025 | 0% |
| 価値関数 | 0.013 | 0.013 | 0% |
| Valence | 0.0 | 0.0 | 0% |
| Coherence | 0.43 | 0.43 | 0% |

**問題**: すべての指標が変化していない。特に、Valenceが0のまま。

---

## 2. バグの発見と修正

### 問題1: Valenceの記録バグ

**発見**: `rssm_info`に`valence_mean`が含まれていなかった。

**原因**: ConditionalAdjunctionModelV4のforward()で、Agent Cの`valence`を`agent_info`に追加していなかった。

**修正**:
```python
# src/models/conditional_adjunction_v4.py
if 'valence' in agent_info:
    agent_info['valence_mean'] = agent_info['valence'].mean(dim=-1)
```

### 問題2: Curiosity報酬の符号問題

**発見**: Curiosity報酬が常に負（-0.099）。

**原因**: 
- Curiosity報酬の定義: `R_curiosity = -(uncertainty_curr - uncertainty_prev)`
- エピソード内でUncertaintyが増加（探索行動）
- したがって、`uncertainty_curr > uncertainty_prev` → `R_curiosity < 0`

**理論的考察**:
- Uncertaintyの増加は「探索」を意味し、本来は報酬すべき
- しかし、現在の定義では「Uncertaintyの減少」を報酬としている
- これは「不確実性の解消」を報酬とする設計だが、探索段階では不適切

**対処**: Curiosity報酬を無効化（α=0.0）

### 実験結果（v2: バグ修正後）

| 指標 | 初期値 | 最終値 | 変化 |
|:---|---:|---:|---:|
| 内発的報酬 | 0.025 | 0.340 | **+1260%** |
| 価値関数 | 0.013 | 4.944 | **+38000%** |
| Valence | 0.58 | 0.661 | **+14%** |
| Coherence | 0.43 | 0.43 | 0% |

**成果**: バグ修正により、劇的な改善。しかし、新たな問題が浮上。

---

## 3. Competence報酬の設計問題

### 問題の発見

v2の実験で、Competence報酬が極めて小さい（-9e-5オーダー）ことが判明。

**内発的報酬の内訳（v2、エピソード100）**:
- Curiosity: -0.099（無効化されているが、計算上は負）
- Competence: **-0.0092**（極小、負）
- Novelty: +0.051（正、大きい）
- **合計**: 0.015（Noveltyが100%を占める）

### 根本原因の分析

**Competence報酬の定義（v2）**:
```python
delta_coherence = coherence_prev - coherence_curr
R_competence = delta_coherence * attention_weight * 100.0
```

**期待される挙動**:
- Coherenceが減少（破綻が解消）→ `delta_coherence > 0` → `R_competence > 0`
- Coherenceが増加（破綻が悪化）→ `delta_coherence < 0` → `R_competence < 0`

**観察された挙動**:
- `R_competence < 0`（常に負）
- これは、Coherenceが常に増加していることを意味

**Coherenceの推移（v2）**:
- エピソード0: 0.426
- エピソード100: 0.442
- トレンド: **増加**（+0.016）

### 理論的ジレンマ

**問題の本質**:
1. F/Gの重みが固定されている
2. Agent Cは破綻を減少させる手段を持たない
3. したがって、Competence報酬（破綻の減少）は常に負または0

**AGENT_GUIDELINES.mdの洞察との矛盾**:
> 「破綻に向き合い、それを理解することで有能感を得る」

現在の実装では、「破綻の減少」を報酬としているが、Agent Cは破綻を減少させる手段を持たない。これは設計の矛盾である。

---

## 4. Competence報酬の再設計

### 再設計の方針

**問い**: F/Gが固定されている状況で、「有能感」とは何か？

**答え**: 破綻を減少させることではなく、**破綻に注目すること**。

**AGENT_GUIDELINES.mdの原則**:
> 「破綻が死を意味しない」
> 「保留構造は、破綻から逃げないことで創発する」

**新しい定義**:
```python
# Before: 破綻の減少を報酬とする
R_competence = (coherence_prev - coherence_curr) * attention * 100

# After: 破綻への注目を報酬とする
R_competence = coherence_curr * attention * 100
```

### 理論的正当化

**3つの視点**:

1. **F/Gが固定されている現実への適応**
   - Agent Cは破綻を減少させる手段を持たない
   - したがって、「破綻への向き合い」を報酬とする

2. **保留構造の創発条件**
   - suspension_and_confidence.mdの洞察: 「破綻が死を意味しない」
   - 破綻に注目することは、破綻から逃げないことを意味する
   - これは、保留構造の創発に必要な条件

3. **「有能感」の再定義**
   - 有能感とは「問題を解決すること」ではない
   - 有能感とは「困難に向き合うこと」である
   - これは、人間の心理学（Deci & Ryan, 2000）とも整合

### 実験結果（v3: Competence報酬再設計後）

**短時間検証（30エピソード）**:

| 指標 | v2 | v3 | 改善 |
|:---|---:|---:|---:|
| Competence報酬 | -0.0092 | **+0.079** | **符号反転、1000倍増加** |
| 内発的報酬への寄与 | -37% | **59.5%** | **主要な駆動力に** |
| Novelty報酬の寄与 | 136% | 40.5% | バランス改善 |

**本格的実験（100エピソード）**:

| 指標 | 初期値 | 最終値 | 変化 |
|:---|---:|---:|---:|
| 内発的報酬 | 0.025 | **0.421** | **+1584%** |
| 価値関数 | 0.013 | **6.639** | **+51000%** |
| Valence | 0.58 | **0.667** | **+15%** |
| Coherence | 0.43 | 0.43 | 0%（安定） |
| Uncertainty | 67.0 | **67.9** | **+1.3%（増加）** |

---

## 5. 保留構造の萌芽？

### 観察された現象

**1. 内発的報酬の指数関数的成長**

- エピソード0-30: 0.063 → 0.078（緩やか）
- エピソード30-60: 0.078 → 0.150（加速）
- エピソード60-100: 0.150 → 0.421（**指数関数的**）

**解釈**: エピソード60以降の急加速は、「臨界点」を超えた可能性。Agent Cは「価値ある状態」を見つける能力を急速に発達させている。

**2. Uncertaintyの増加（v3）**

- v2: 67.05 → 66.65（減少）
- v3: 67.0 → 67.9（**増加**）

**解釈**: v3では、Uncertaintyが増加している。これは、Agent Cが「新しい状態」を探索していることを示す。Competence報酬（破綻への注目）が、探索を促進している可能性。

**3. Valenceの加速的成長**

- エピソード0-50: 0.58 → 0.61（+0.03）
- エピソード50-100: 0.61 → 0.67（**+0.06、2倍の速度**）

**解釈**: Valenceの成長が加速している。これは、Agent Cが「経験的価値判断」を急速に発達させていることを示す。

**4. Coherenceの安定性**

- 平均: 0.43（ほぼ一定）
- 変化: -0.0006（微減）

**解釈**: Agent Cは破綻を避けていない。Coherence最小化崩壊は発生していない。設計意図通り。

### suspension_and_confidence.mdの洞察との対応

**洞察1: 「確定」と「未確定」の往復**

> 「保留の本質は、確定と未確定の往復である」

**現在の状態**:
- 「確定」: F/Gの重みは固定
- 「未確定」: Agent Cの内部状態は急速に変化
- 「往復」: Uncertaintyの増加が示唆（v3）

**洞察2: 「破綻が死を意味しない」**

> 「保留構造は、破綻が死を意味しない環境で創発する」

**現在の状態**:
- Agent Cは破綻を避けていない（Coherence一定）
- Competence報酬（破綻への注目）が主要な駆動力（59.5%）
- これは、「破綻から逃げない」ことを学習していることを示す

### 結論: 保留構造の萌芽の可能性

**証拠**:
1. 内発的報酬の指数関数的成長（臨界点の通過？）
2. Uncertaintyの増加（「確定→未確定」の移行？）
3. Valenceの加速的成長（経験的価値判断の発達）
4. Coherenceの安定性（破綻を避けていない）
5. Competence報酬の支配（破綻への注目が主要な駆動力）

**ただし**:
- 保留構造の完全な創発には至っていない
- より長期の訓練（1000エピソード）が必要
- F/Gの学習を再開し、「確定→未確定→確定」の往復を実現する必要

---

## 6. 理論的洞察

### 洞察1: 内発的動機は保留を促進する（条件付き）

**問い**: 内発的動機は保留構造を促進するか、阻害するか？

**答え**: **促進する。ただし、Competence報酬の設計が重要。**

**証拠**:
- v2（Competence報酬 = 破綻の減少）: Novelty報酬が支配、Competence報酬は負
- v3（Competence報酬 = 破綻への注目）: Competence報酬が主要な駆動力（59.5%）

**結論**: 内発的動機は保留を阻害しない。むしろ、適切に設計されたCompetence報酬は、保留を促進する。

### 洞察2: Competence報酬の設計は文脈依存

**一般的な定義**（Active Inference, DreamerV3）:
```python
R_competence = improvement_in_prediction_accuracy
```

**F/Gが固定されている場合の定義**:
```python
R_competence = attending_to_breakdowns
```

**理由**: F/Gが固定されている場合、Agent Cは破綻を減少させる手段を持たない。したがって、「破綻への向き合い」を報酬とする必要がある。

**一般化**: Competence報酬の定義は、エージェントが持つ「行動の自由度」に依存する。

### 洞察3: 「破綻への注目」は保留の創発条件

**AGENT_GUIDELINES.mdの原則**:
> 「保留構造は、破綻から逃げないことで創発する」

**v3の実験結果**:
- Competence報酬（破綻への注目）が内発的報酬の59.5%を占める
- Agent Cは破綻を避けていない（Coherence一定）
- Uncertaintyが増加（探索）

**結論**: 「破綻への注目」を報酬とすることは、保留構造の創発条件を満たす。

### 洞察4: Uncertaintyの増加は「確定→未確定」の移行

**suspension_and_confidence.mdの洞察**:
> 「確定と未確定の往復が保留の本質」

**v3の観察**:
- Uncertaintyが増加（67.0 → 67.9）
- これは、Agent Cが「確定した状態」から「未確定な状態」へ移行していることを示唆

**ただし**:
- 「未確定→確定」の逆方向の移行は観察されていない
- F/Gの学習を再開する必要がある

---

## 7. 次のステップ

### 即時（文書化）

1. **TODO.mdの更新** ✓
   - 優先度A2（本格的訓練実験）を完了としてマーク
   - 新たな発見を記録

2. **この議論ログの作成** ✓
   - Competence報酬の再設計に関する議論
   - 保留構造の萌芽に関する考察

### 短期（研究ノートの更新）

3. **research_note_ja.mdの更新**
   - セクション3.5（Agent C v4の実装）
   - セクション5.5（実験結果）
   - 新セクション5.6（Competence報酬の再設計と保留構造の萌芽）

### 中期（さらなる実験）

4. **より長期の訓練（1000エピソード）**
   - 保留構造の完全な創発を観察
   - 価値関数の収束を確認
   - Uncertaintyの「往復」を観察

5. **F/Gの学習を再開**
   - Agent CとF/Gの共進化を観察
   - 「確定→未確定→確定」の往復を実現

### 長期（理論的発展）

6. **確信度の導入**
   - suspension_and_confidence.mdの提案を実装
   - 「確定→未確定」の往復を定量化

7. **アクション選択機構の検討**
   - より複雑なタスクでの必要性を評価
   - 保留構造との整合性を確認

---

## 8. 理論への影響

### AGENT_GUIDELINES.mdの原則の検証

**原則1: 「保留構造は設計しない、創発する条件を設計する」**
- ✅ 検証: Competence報酬の再設計は、保留の創発条件を設計したもの
- ✅ 結果: 保留構造の萌芽が観察された

**原則2: 「Coherence Signalは最小化すべき損失ではない」**
- ✅ 検証: Coherenceは一定（最小化されていない）
- ✅ 結果: Coherence最小化崩壊は発生していない

**原則3: 「破綻が死を意味しない」**
- ✅ 検証: Agent Cは破綻を避けていない
- ✅ 結果: Competence報酬（破綻への注目）が主要な駆動力

### suspension_and_confidence.mdの洞察の検証

**洞察1: 「確定と未確定の往復が保留の本質」**
- ⚠️ 部分的に検証: Uncertaintyの増加（「確定→未確定」）は観察されたが、逆方向は未確認

**洞察2: 「破綻から逃げないことが保留の創発条件」**
- ✅ 検証: Agent Cは破綻を避けていない
- ✅ 結果: 保留構造の萌芽が観察された

### 新たな理論的問い

1. **Uncertaintyの往復は実現するか？**
   - F/Gの学習を再開すると、Uncertaintyは減少（「未確定→確定」）するか？
   - その後、再び増加（「確定→未確定」）するか？

2. **保留構造の完全な創発には何が必要か？**
   - より長期の訓練（1000エピソード）で十分か？
   - F/Gの学習再開が必須か？
   - 確信度の導入が必要か？

3. **Competence報酬の一般化**
   - F/Gが学習可能な場合、Competence報酬はどう定義すべきか？
   - 「破綻の減少」と「破綻への注目」のどちらが適切か？
   - 両者を組み合わせることは可能か？

---

## 9. AIの常識が通じない部分（再確認）

今日の実験を通じて、2月13日午前の議論で指摘された「AIの常識が通じない部分」が再確認された。

**「損失を下げれば性能が上がる」は通用しない。**
- Coherenceを下げることは目的ではない
- むしろ、Coherenceに注目することが報酬

**「報酬を増やせば良い行動が増える」は単純ではない。**
- Competence報酬の定義を変えるだけで、結果が劇的に変わる
- 「破綻の減少」と「破綻への注目」は、真逆の設計思想

**「指数関数的成長＝過学習」ではない。**
- エピソード60以降の指数関数的成長は、過学習ではなく、臨界点の通過の可能性
- これは、保留構造の創発の兆候かもしれない

**「実験結果を数値で判断する」だけでは不十分。**
- Uncertaintyの増加は「悪化」ではなく、「探索」の証拠
- Coherenceの一定は「停滞」ではなく、「破綻を避けていない」証拠

このモデルを正しく理解するためには、「この設計だからこうなる」という視点で実験結果を読む必要がある。

---

**議論日**: 2026-02-13（午後）
**参加者**: AI Agent (Manus)
**ステータス**: Competence報酬の再設計完了、保留構造の萌芽を観察
