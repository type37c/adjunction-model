# 開発継続計画 (2026-02-13)

## 現状分析

### 完了済み実装
- **Phase 1**: F⊣G 随伴層（完了）
- **Phase 2**: Agent Layer C v4まで完了
  - v1: 基本RSSM
  - v2: Priority-based Attention
  - v3: Valence Memory
  - v4: 内発的動機（好奇心、有能感、新奇性）+ 価値関数
- **検証**: test_value_based_training.pyが全テスト通過

### 特定された問題点

#### 1. アクション選択の欠如（重要度：高）
**問題**: action_selection_analysis_2026_02_13.mdで指摘されている通り、Agent Cが明示的にアクションを選択していない。

**現状**:
- Agent Cは観測を受け取る
- 内部状態を更新する
- FiLMパラメータを出力してF/Gを変調する
- 内発的報酬を計算する
- 価値関数を更新する

**欠けているもの**:
- 確率的なアクション選択（policy network）
- アクションの実行
- アクションに基づく環境との相互作用

**Active Inference/DreamerV3との比較**:
```
期待される流れ:
1. 観測を受け取る
2. 内部状態を更新
3. アクション選択（policy network経由）← 欠如
4. アクションを実行 ← 欠如
5. 報酬を受け取る
6. 状態と価値関数を更新
```

**理論的考察**:
- 現在のAgent Cは「注意の配分」と「FiLM変調」を行っているが、これは決定論的な調整であり、確率的なアクション選択ではない
- 保留構造の創発には、「選択」という能動的な行為が必要である可能性
- ただし、AGENT_GUIDELINES.mdの原則「保留構造は設計しない、創発する条件を設計する」に注意

#### 2. TODO.mdの高優先度タスク

**2.1 本格的な訓練実験の実施**
- 現状: test_value_based_training.pyは検証テストのみ（3エピソード）
- 必要: より大規模なデータセットでの訓練
- 目的: Agent Cの創発的振る舞いの分析

**2.2 research_note_ja.mdの更新**
- セクション3.5: 目的空間P（内発的動機での改訂）
- セクション5.5: 言語接地（Pを中間層とする3層構造への改訂）

**2.3 議論ログエントリの作成**
- 内発的動機の開発プロセスの文書化
- coherenceベースからrewardベースのvalenceへの移行の説明

#### 3. 保留構造の創発条件の検証（中優先度）

**suspension_and_confidence.mdからの洞察**:
- 「確定」と「未確定」の往復が保留の本質
- 現状: 重みは常に確定値
- 提案: 「確信度」という次元の導入

**検証すべき問い**:
- 内発的動機は保留構造の創発につながるか？
- それとも「目的を持ちすぎる」ことで保留を阻害するか？

## 開発タスクの優先順位付け

### 優先度A（即時着手）

#### A1. アクション選択機構の設計と実装
**目的**: Agent Cに明示的なアクション選択能力を付与する

**設計方針**:
1. **アクション空間の定義**
   - 現在のFiLMパラメータ調整を「アクション」として形式化
   - または、新たなアクション空間を定義（例: 探索/活用、注意の移動方向）

2. **Policy Networkの追加**
   - Agent Cの状態から確率的にアクションを選択
   - Actor-Criticアーキテクチャの検討

3. **理論的整合性の確認**
   - AGENT_GUIDELINES.mdの原則との整合性
   - 保留構造の創発を阻害しないか

**実装ステップ**:
1. アクション空間の形式化（設計文書）
2. Policy Networkの実装（agent_layer_v5.py?）
3. 訓練ループの改訂（train_agent_value_based.pyの拡張）
4. 検証テストの作成

**懸念事項**:
- アクション選択を明示的に設計することは、「保留構造を設計する」ことにならないか？
- FiLM変調自体がすでに「アクション」として機能しているのではないか？

#### A2. 本格的訓練実験の実施
**目的**: Agent C v4の振る舞いを大規模データで検証

**実装**:
1. より大きな合成データセット（100+ shapes）
2. 長期訓練（100+ episodes）
3. 可視化ツールの作成
   - 内発的報酬の時系列プロット
   - 価値関数のランドスケープ
   - Agent Cの潜在状態の軌跡

**期待される知見**:
- Agent Cは「戦略」を発達させるか？
- Valenceはどのように進化するか？
- 保留構造の萌芽は観察されるか？

### 優先度B（短期）

#### B1. research_note_ja.mdの更新
**セクション3.5の改訂**:
- 旧: 「目的空間は不要」
- 新: 「目的空間Pは内発的動機として実装」

**セクション5.5の改訂**:
- 旧: 「Shape ⇄ Action ⇄ Language の随伴の連鎖」
- 新: 「3層構造: 身体的随伴 → 目的空間P → 言語」

#### B2. 議論ログの作成
**内容**:
- 2026-02-13の開発プロセス
- 内発的動機の理論的根拠
- coherenceベースからrewardベースへの移行

### 優先度C（中期）

#### C1. 保留構造の創発条件の調査
**実験**:
1. Agent Cは破綻に向き合うか、回避するか？
2. 内発的動機は保留を促進するか、阻害するか？

**測定指標**:
- 破綻への接近/回避行動
- 「確定→未確定」の往復の頻度
- Valenceの変動パターン

#### C2. 確信度（Confidence）の導入検討
**suspension_and_confidence.mdの提案**:
```python
weight = 0.5
confidence = 0.8  # 高い = 確定、低い = 余白

if coherence_breakdown and confidence > threshold:
    confidence *= decay  # 確定を壊して未確定に
```

**検討事項**:
- これは「保留構造の設計」か「創発条件の設計」か？
- 内発的動機との関係は？

## 推奨される開発順序

### フェーズ1: 理論的検討（1日）
1. アクション選択の必要性を理論的に検討
2. AGENT_GUIDELINES.mdの原則との整合性確認
3. 設計文書の作成

### フェーズ2: 実験による検証（2-3日）
1. 本格的訓練実験の実施（A2）
2. 現在の実装（v4）の振る舞い分析
3. アクション選択の欠如が問題かどうかの判断

### フェーズ3: 実装（必要に応じて）
1. アクション選択機構の実装（A1、必要な場合）
2. 検証テストの作成
3. 統合テスト

### フェーズ4: ドキュメント更新
1. research_note_ja.mdの更新（B1）
2. 議論ログの作成（B2）

## 未解決の理論的問題

### 問1: アクション選択は必要か？
**問い**: 現在のFiLM変調と注意配分は、すでに「アクション」として機能しているのではないか？

**検討**:
- Pro: FiLMパラメータの調整は、F/Gの振る舞いを変える「行為」である
- Con: しかし決定論的であり、確率的な「選択」ではない
- 保留構造の観点: 「選択」には「迷い」が必要？

### 問2: 保留構造の創発条件とは何か？
**AGENT_GUIDELINES.mdより**:
1. Coherence Signalが消えない環境
2. 破綻が死を意味しない構造
3. 抽象度の自由な移動

**現状の実装**:
1. ✓ Coherence Signalは存在（最小化されない）
2. ✓ 破綻は報酬の一部（致命的ではない）
3. ? 抽象度の移動は実装されているか？

### 問3: 内発的動機は保留を促進するか、阻害するか？
**仮説A**: 促進する
- 内発的動機により、Agent Cは破綻に向き合う理由を持つ
- 「有能感」報酬は破綻の解消を促す

**仮説B**: 阻害する
- 内発的動機により、Agent Cは「目的を持ちすぎる」
- 保留（未確定のまま保持）ではなく、即座の解決を求める

**検証方法**: 本格的訓練実験での観察

## 次のステップ

### 即座に実施すべきこと
1. **本格的訓練実験の実装と実行**（A2）
   - これにより、アクション選択の必要性が明確になる
   - 現在の実装の限界が見える

2. **アクション選択の理論的検討**（A1の準備）
   - 設計文書の作成
   - AGENT_GUIDELINES.mdとの整合性確認

### 判断を保留すべきこと
1. アクション選択機構の実装（実験結果を見てから）
2. 確信度の導入（保留構造の創発が観察されてから）

### ユーザーに確認すべきこと
1. アクション選択の優先度
2. 開発の方向性（実験優先 vs 実装優先）
3. 理論的懸念（「設計 vs 創発」の境界）
