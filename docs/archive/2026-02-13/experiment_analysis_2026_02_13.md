# 本格的訓練実験の分析 (2026-02-13)

## 実験概要

**目的**: Agent C v4の本格的な訓練を実施し、内発的動機に基づく自律的学習の振る舞いを分析する

**設定**:
- エピソード数: 100
- エピソード長: 10 shapes/episode
- ユニーク形状数: 50 (cube, cylinder, sphere)
- 点群サイズ: 512 points
- F/Gパラメータ: **凍結** (Agent Cのみ学習)

**モデル構成**:
- ConditionalAdjunctionModelV4
  - Functor F: 64 hidden dim
  - Functor G: 128 hidden dim
  - Agent C v4: 256 hidden dim, 64 latent dim
  - Valence: 32 dim
  - 内発的動機: α=0.3 (curiosity), β=0.5 (competence), γ=0.2 (novelty)
- Value Function: 128 hidden dim
- 総パラメータ数: 1,604,658 (model) + 61,825 (value function)

## 主要な発見

### 1. 内発的報酬の改善

```
r_intrinsic: -0.0215 (初期) → 0.0087 (最終) (Δ +0.0302)
```

**解釈**:
- 訓練開始時、Agent Cは負の内発的報酬を受け取っていた
- 100エピソード後、正の内発的報酬を獲得するようになった
- これは、Agent Cが「価値ある状態」を見つけることを学習したことを示す

**理論的意義**:
- Agent Cは外部からの教師信号なしに、内発的動機のみで改善している
- これは「保留構造の創発条件」の1つ（coherence signalが消えない環境）が機能していることを示唆

### 2. 価値関数の収束

```
value_start: -0.1591 (初期) → 0.0125 (最終) (Δ +0.1716)
```

**解釈**:
- 価値関数V(state)が正の値に収束
- Agent Cは「将来の内発的報酬が期待できる状態」を生成することを学習
- TD lossは最終的に0.0099まで低下（価値推定が安定）

**理論的意義**:
- 価値関数がAgent Cの学習を正しく導いている
- 「coherence最小化崩壊」は発生していない（coherenceは一定を保っている）

### 3. Coherenceの安定性

```
avg_coherence: 0.4328 (初期) → 0.4320 (最終) (Δ -0.0007)
```

**解釈**:
- Coherence signalはほぼ一定（微減）
- Agent Cは破綻を「避ける」のではなく、「向き合う」ことを学習している
- これは設計意図通り：coherenceを最小化するのではなく、破綻を創造的問題解決の契機とする

**理論的意義**:
- AGENT_GUIDELINES.mdの原則「Coherence Signalは最小化すべき損失ではなく、モード切替のための内部指標」が実装されている
- 保留構造の萌芽の可能性

### 4. Valenceの問題

```
avg_valence: 0.0000 (初期) → 0.0000 (最終) (Δ +0.0000)
```

**問題**:
- Valenceが全く変化していない（常に0.0）
- これは設計上の問題を示唆

**考えられる原因**:
1. Valence Memoryの更新ロジックにバグがある
2. Valenceの初期化が不適切
3. 内発的報酬からValenceへの変換が機能していない

**対処が必要**:
- ValenceMemoryV2の実装を確認
- デバッグ出力を追加して更新プロセスを追跡

## 詳細分析

### 内発的報酬の成分

エピソード100の内発的報酬の内訳を確認する必要がある：
- R_curiosity: 不確実性の減少
- R_competence: 破綻の解消
- R_novelty: 新規パターンの発見

これらの成分がどのように変化したかを分析することで、Agent Cの学習戦略が見える。

### 価値関数のランドスケープ

生成された可視化（value_function.png）を確認することで：
- 価値関数の収束パターン
- TD lossの減少傾向
- エピソード間の変動

これらから、学習の安定性と収束速度を評価できる。

### Agent Cの内部状態

生成された可視化（agent_state.png）を確認することで：
- Coherence signalの時系列変化
- Uncertaintyの推移
- Valenceの推移（ただし現在は0.0で固定）

## 理論的考察

### 1. アクション選択の欠如は問題か？

**観察**:
- Agent Cは明示的なアクション選択を行っていない
- しかし、内発的報酬は改善し、価値関数は収束している

**解釈**:
- 現在のFiLM変調と注意配分は、実質的に「アクション」として機能している可能性
- Agent Cは「どの点に注意を向けるか」「F/Gをどう変調するか」を学習している
- これは確率的なアクション選択ではないが、決定論的な「選択」である

**結論（暫定）**:
- アクション選択機構の追加は、現時点では必須ではない
- ただし、より複雑なタスクでは必要になる可能性がある

### 2. 保留構造は創発しているか？

**観察**:
- Coherence signalは一定（破綻を避けていない）
- 内発的報酬は改善（破綻に向き合っている）
- Valenceは変化していない（問題）

**解釈**:
- 保留構造の萌芽は見られるが、完全な創発には至っていない
- Valenceの問題が保留構造の発達を阻害している可能性

**suspension_and_confidence.mdの洞察との対応**:
> 「確定」と「未確定」の往復が保留の本質

現在の実装では：
- 「確定」: F/Gの重みは固定
- 「未確定」: Agent Cの内部状態は変化
- しかし、「確定を壊す」プロセスが明示的でない

**次のステップ**:
- Valenceの問題を修正
- 「確信度」の導入を検討（suspension_and_confidence.mdの提案）

### 3. 内発的動機は保留を促進するか、阻害するか？

**仮説A（促進）の証拠**:
- Agent Cは破綻を避けていない（coherence一定）
- 内発的報酬の改善は、破綻への「向き合い」を示唆

**仮説B（阻害）の証拠**:
- 保留構造の完全な創発は観察されていない
- Valenceの停滞は、「目的を持ちすぎる」ことの弊害かもしれない

**結論（暫定）**:
- 内発的動機は保留を阻害していない（少なくとも明白な証拠はない）
- しかし、促進しているとも断言できない
- Valenceの問題を解決してから再評価が必要

## 発見された問題

### 高優先度：Valenceが更新されていない

**症状**:
- avg_valence: 0.0000 (全エピソードで一定)

**調査が必要**:
1. ValenceMemoryV2の実装を確認
2. 内発的報酬の計算を確認
3. Valence更新のロジックを確認

**仮説**:
- ValenceMemoryV2のforward()が呼ばれていない
- または、Valenceの初期化が0.0で、更新ロジックが機能していない

### 中優先度：内発的報酬の成分分析

**必要な情報**:
- R_curiosity, R_competence, R_noveltyの個別の推移
- これらの成分がどのように内発的報酬に寄与しているか

**対処**:
- metrics.jsonに成分別の記録があるはずなので、可視化を追加

## 次のステップ

### 即時（デバッグ）

1. **Valenceの問題を調査**
   - ValenceMemoryV2の実装を確認
   - デバッグ出力を追加
   - テストケースを作成

2. **内発的報酬の成分を可視化**
   - metrics.jsonからR_curiosity, R_competence, R_noveltyを抽出
   - 時系列プロットを作成

### 短期（実験の拡張）

3. **より長期の訓練**
   - 1000エピソードで訓練
   - 保留構造の創発を観察

4. **異なるハイパーパラメータ**
   - α, β, γの比率を変更
   - Valence decayの調整

### 中期（理論的検討）

5. **確信度の導入**
   - suspension_and_confidence.mdの提案を実装
   - 「確定→未確定」の往復を実現

6. **アクション選択機構の検討**
   - 必要性を再評価
   - 実装方針を決定

## 結論

本格的訓練実験により、以下が確認された：

**成功した点**:
1. ✓ Agent C v4は内発的動機のみで学習できる
2. ✓ 価値関数は正しく収束する
3. ✓ Coherence最小化崩壊は発生していない
4. ✓ F/Gを凍結してもAgent Cは学習できる

**発見された問題**:
1. ✗ Valenceが全く更新されていない（重大なバグの可能性）
2. ? 保留構造の創発は不明確（Valenceの問題が影響している可能性）

**理論的洞察**:
1. アクション選択の明示的な実装は、現時点では必須ではない
2. 内発的動機は保留を阻害していない（少なくとも明白な証拠はない）
3. Valenceの問題を解決することが、次の重要なステップ

**AGENT_GUIDELINES.mdの原則との整合性**:
- ✓ 「保留構造は設計しない、創発する条件を設計する」: 内発的動機という条件を設計した
- ✓ 「Coherence Signalは最小化すべき損失ではない」: Coherenceは一定を保っている
- ? 「保留構造の創発」: まだ明確には観察されていない

---

**実験日**: 2026-02-13
**実験者**: AI Agent (Manus)
**ステータス**: 完了（Valenceの問題要調査）
